import{j as s}from"./controls-D0X05BJI.js";import{a}from"./react-gDunJgQi.js";import{u as A,c as N,E as L,d as R,s as B,e as G,g as $,h as q,i as H,j as K,k as v,S as M,G as D,l as V,P as F,a as b,r as U,b as Y,V as J}from"./index-DDoHmH-b.js";import{K as P,aa as Q}from"./uikit-B7lfAg5T.js";const W=({editorData:m,partSchemaName:r,isReadOnly:E,recordType:i,onSubmit:c})=>{const{t:w}=A(),{getSchema:f}=N(),[n,S]=a.useState(null);a.useEffect(()=>{i&&r&&f.fetch({name:i}).then(e=>{S({data:m,schema:e.typeList,rootSchemaName:Object.keys(e.typeList)?.find(o=>o.endsWith(r))||""})})},[i,r,m]);const g=({data:e})=>!m&&c?.(e),x=({data:e})=>c?.(e),h=a.useMemo(()=>n?.schema?.[n.rootSchemaName].Elements?.every(e=>e.Optional),[n?.schema,n?.rootSchemaName]);return f.isLoading?s.jsx(P,{loading:!0}):n?s.jsx(L,{...n,readOnly:E,i18n:{submitBtnText:w("buttons.apply")},onInit:g,onSubmit:x,isSubmitDisabled:!h}):s.jsx(Q,{})},X="_editorViewer_deg0n_1",Z="_viewerData_deg0n_8",k={editorViewer:X,viewerData:Z},ee=a.memo(({activeTab:m,panelKey:r,panelType:E,panelWithParamsName:i})=>{const c=a.useRef(null),w=R(B),{eventsBatch:f}=G(),n=R($),{activeTab:S}=q(),{state:g}=H(),h=R(K)||g.isTypeReadOnly,e=a.useMemo(()=>structuredClone(f),[f]),o=`${r}${i}`,[j,u]=a.useState(!1),[T,I]=a.useState(v.getParamsViewers()),[p,z]=a.useState(null);a.useEffect(()=>{c.current&&c.current.setLayout([50,50])},[m]),a.useEffect(()=>{u(!1)},[i]),a.useEffect(()=>{if(e.length!==0){for(const t of e)if(M.includes(t.EventKind)&&p&&p.taskRunId===t.TaskRunId){const{Status:l,TaskRunId:d}=t;l===D.Completed?_(d,p?.data):(l===D.Failed||l===D.Cancelled)&&(u(!1),v.removeParamsViewer(o))}}},[e]);const _=(t,l)=>{const d={dataset:w.activeDatasetName,taskRunIds:[t]};V.runTasksResult(d).then(y=>{y.length&&(v.setParamsViewers(o,{editorData:l,viewerData:y[0].Result}),u(!1))}).finally(()=>u(!1))},C=t=>{const l={dataset:w.activeDatasetName,type:S?.id||"",keys:r?[r]:[],method:i||"",args:t,userId:n?.id??n?.username};u(!0),V.runTasks(l).then(d=>{d[0].TaskRunId&&(z({taskRunId:d[0].TaskRunId,data:t}),I({...T,[o]:{editorData:t,viewerData:null}}))}).finally(()=>{u(!1)})};if(!S?.id)return null;const O=()=>{if(j)return s.jsx(P,{loading:!0});const t=v.getParamsViewers()[o]?.viewerData;return s.jsx(J,{activeViewerType:t?._t,data:t})};return s.jsxs(F,{direction:"horizontal",ref:c,children:[s.jsx(b,{id:"horizontal-params-viewer",className:k.editorViewer,onResize:U,minSize:25,defaultSize:25,children:s.jsx(W,{isReadOnly:h,recordType:E||S.id,partSchemaName:`${i}Args`,editorData:T?.[o]?.editorData,onSubmit:C})}),s.jsx(Y,{className:"verticalPanelResizer"}),s.jsx(b,{className:k.viewerData,minSize:25,defaultSize:75,children:O()})]})});ee.displayName="ParamsViewer";export{ee as default};
