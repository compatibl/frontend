/**
 * Copyright (C) 2003-present CompatibL. All rights reserved.
 * This file contains valuable trade secrets and may be copied, stored, used,
 * or distributed only in compliance with the terms of a written commercial
 * license from CompatibL and with the inclusion of this copyright notice.
 */
import{W as V,s as W,c as B,u as X,S as Z,w as ee,a as le,j as l,Y as te,b as P,Q as K,d as ne,e as ie,f as se,h as re,J as k,i as Y,n as oe,l as ae,m as ue,o as D,p as ce,q as z,r as de,t as q,v as be,x as he,y as me,E as ve,z as pe,A as $,B as H,C as Q,D as G}from"./controls-yP1HmfZA.js";import{r as u}from"./react-CxujAPCK.js";import{r as O}from"./v4-C71QHj5u-OHFAfwco.js";const ge=[{label:"Sort Asc",value:V.ASC,SvgIcon:W},{label:"Sort Desc",value:V.DESC,SvgIcon:B},{label:"No Sort",value:V.NONE,SvgIcon:X}],fe=({handleChangeSorting:t})=>{const e=a=>()=>t(a),n=ge.map(({SvgIcon:a,value:s,label:h},r)=>({key:r,label:l.jsxs("button",{onClick:e(s),className:"ui-builder-sort-dropdown__item",type:"button",children:[l.jsx(z,{SvgIcon:a}),l.jsx("span",{className:"ui-builder-sort-dropdown__label",children:h})]},s)}));return l.jsx(ce,{placement:"bottom",menu:{items:n,selectable:!0},children:l.jsx(z,{clickable:!1,SvgIcon:de})})},xe=({isOpen:t,handleToggleFilter:e,colFilter:n,changeDropdownFilters:a,dropdownFilters:s=[],triggerRef:h,setCheckedItems:r,checkedItems:o})=>{const{debounce:v}=P(),d=u.useRef(null),[b,p]=u.useState(n.AvailableValues);u.useEffect(()=>{p(n.AvailableValues)},[n.AvailableValues]),u.useEffect(()=>{t||(p(n.AvailableValues),r(s))},[t]),u.useEffect(()=>{const c=i=>{var m,x;const N=i.target,E=(m=d.current)==null?void 0:m.contains(N),y=(x=h==null?void 0:h.current)==null?void 0:x.contains(N);!E&&!y&&e(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[d,h]),u.useEffect(()=>{const c=()=>{t&&e(!1)};return window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c)}},[t]);const g=c=>{v({fn:f,value:c})},f=c=>{const i=n.AvailableValues.filter(m=>m.toLowerCase().includes(c.toLowerCase()));p(i)},w=()=>{const c=o.length===n.AvailableValues.length?[]:n.AvailableValues;return r(c)},C=c=>{o.includes(c)?r(o.filter(i=>i!==c)):r([...o,c])},_=()=>{a(o),e(!1)},S=u.useMemo(()=>{const c=[],i=[];return b.forEach(m=>{if(m.trim()===""){const N=O();i.push({value:m,id:N});return}const x=O();c.push({value:m,id:x})}),[...c,...i]},[b]);return t?l.jsxs("div",{className:"ui-builder-filter-dropdown__container",ref:d,children:[l.jsxs("div",{className:"ui-builder-filter-dropdown__header",children:[l.jsx(pe,{className:"ui-builder-filter-dropdown__input",onChange:g}),l.jsx($,{className:"ui-builder-filter-dropdown__list-item",value:o.length===n.AvailableValues.length,intermediate:o.length>0,onChange:w,children:"All"})]}),l.jsx("div",{className:"ui-builder-filter-dropdown__list",children:S.map(({value:c,id:i})=>l.jsx($,{className:"ui-builder-filter-dropdown__list-item",value:o.includes(c),onChange:()=>C(c),children:c.trim().length===0?"(None)":c},i))}),l.jsxs("footer",{className:"ui-builder-filter-dropdown__footer",children:[l.jsx(H,{onClick:_,children:"Apply"}),l.jsx(H,{onClick:()=>e(!1),variant:"ghost",children:"Cancel"})]})]}):null},Ce=({column:t,colFilter:e,showPlaceholder:n})=>{const a=t.getFilterValue(),s=u.useRef(null),h=u.useRef(null),r=u.useRef(null),[o,v]=u.useState(!1),[d,b]=u.useState(a),p=n?"Filter":"",g=e&&e.AvailableValues.length>0,f=i=>{t.setFilterValue(i)},w=()=>{b([]),t.setFilterValue("")},C=!1,_=i=>v(i),S=i=>{t.setFilterValue(i)},c=()=>{var i;const m=(i=h.current)==null?void 0:i.getBoundingClientRect(),x=s.current,N=document.querySelector(".ui-builder");if(m&&x&&N){const E=x.offsetHeight,y=x.offsetWidth,R=N.getBoundingClientRect().bottom-m.bottom;let F=m.right-y+window.scrollX;if(F<0&&(F=10),x.style.top=`${m.top-10}px`,x.style.left=`${F}px`,x.style.position="fixed",R<E){const A=x.querySelector(".ui-builder-filter-dropdown__container");A&&(A.style.maxHeight=`${R-10}px`)}}};return u.useEffect(()=>{const i=s.current;i&&(o?(c(),i.style.visibility="visible"):i.style.visibility="hidden")},[o]),u.useEffect(()=>{const i=s.current;c(),i&&(i.style.visibility="hidden")},[]),l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"ui-builder-filter-input__container",ref:h,children:l.jsxs("div",{className:"ui-builder-filter-input__input-wrapper",children:[l.jsx(q,{value:a||"",readOnly:g,onChange:f,suffix:l.jsxs(l.Fragment,{children:[a&&l.jsx(be,{onClick:w}),g&&l.jsx("span",{ref:r,className:k("ui-builder-filter-input__arrow-icon",{"ui-builder-filter-input__arrow-icon--visible":o,"ui-builder-filter-input__arrow-icon--active":o}),onClick:()=>_(!o),role:"button",children:l.jsx(z,{SvgIcon:he})})]}),className:k(a&&"ui-builder-filter-input--with-value")}),l.jsx("p",{className:"ui-builder-filter-input__placeholder",children:p})]})}),C,g&&l.jsx("div",{ref:s,className:"ui-builder-filter-input__dropdown-wrapper",children:l.jsx(xe,{isOpen:o,triggerRef:r,handleToggleFilter:_,colFilter:e,changeDropdownFilters:S,dropdownFilters:a,checkedItems:d,setCheckedItems:b})})]})},we=t=>t===!1?null:l.jsx(z,{clickable:!1,SvgIcon:t==="asc"?W:B}),_e=({onClick:t,header:e,rowSpan:n,colFilter:a})=>{var s,h,r,o;const v={position:"relative",transition:"width transform 0.2s ease-in-out",whiteSpace:"nowrap",...((h=(s=e.column.columnDef)==null?void 0:s.meta)==null?void 0:h.sizeSettings)??{},width:e.getSize()},d=u.useCallback(C=>{if(e.column.getCanSort())if(C===V.NONE)e.column.clearSorting();else{const _=C===V.DESC;e.column.toggleSorting(_)}},[e.column]),b=!((o=(r=e==null?void 0:e.column)==null?void 0:r.columns)!=null&&o.length),p=we(e.column.getIsSorted()),g=re(e.column.columnDef.header,e.getContext()),f=e.colSpan<=1,w=n&&n>1;return l.jsxs("th",{className:k("ui-builder-table-header-cell",e.column.getCanSort()&&"ui-builder-table-header-cell--sort",w&&"ui-builder-table-header-cell--streched"),style:v,colSpan:e.colSpan,rowSpan:n,children:[l.jsxs("span",{onClick:t,className:k("ui-builder-table-header-cell__sorting-block",!f&&"ui-builder-table-header-cell__sorting-block--center"),role:"button",children:[l.jsx("span",{children:g}),f?l.jsxs("span",{className:"ui-builder-table-header-cell__sort-icons",children:[l.jsx("span",{className:"ui-builder-table-header-cell__sort-icon-wrap",children:p}),l.jsx(fe,{handleChangeSorting:d})]}):null,l.jsx("div",{onDoubleClick:()=>e.column.resetSize(),onMouseDown:e.getResizeHandler(),onTouchStart:e.getResizeHandler(),onClick:C=>{C.stopPropagation()},className:"ui-builder-table-header-cell__resizer",role:"button"})]}),b&&e.column.getCanFilter()?l.jsx(Ce,{showPlaceholder:!0,column:e.column,colFilter:a}):null]},e.id)},Se=({table:t,colFilters:e})=>{const n=u.useRef(new Set);return u.useEffect(()=>{n.current=new Set}),l.jsx("thead",{className:"ui-builder-table__header",children:t.getHeaderGroups().map(a=>l.jsx("tr",{className:"ui-builder-table__row",children:a.headers.map((s,h)=>{var r;const o=(r=s.column.columnDef.meta)==null?void 0:r.rowSpan,v=s.column.columnDef.header;return!s.isPlaceholder&&o!==void 0&&s.id===s.column.id||n.current.has(v)?null:(n.current.add(v),l.jsx(_e,{header:s,onClick:s.column.getToggleSortingHandler(),rowSpan:o,colFilter:e==null?void 0:e.find(d=>d.ColumnId===h)},s.id))})},a.id))})},J=u.createContext(null),je=({isTableEditable:t,children:e})=>{const[n,a]=u.useState({isTableEditable:t});return u.useEffect(()=>{a({isTableEditable:t})},[t]),l.jsx(J.Provider,{value:n,children:e})},U=()=>{const{isTableEditable:t}=u.useContext(J);return t},Ne=({value:t,text:e,buttons:n,triggerClassName:a,isCellTextCropped:s,getScoreProgress:h})=>l.jsx(G,{placement:"bottom",className:"ui-builder-table-cell-tooltip",title:l.jsxs("div",{children:[s&&t.length>10?l.jsx("div",{className:"ui-builder-table-cell-tooltip__text",children:t}):"",l.jsx("div",{className:"ui-builder-table-cell-tooltip__text",children:e}),n!=null&&n.length?l.jsx("div",{className:"ui-builder-table-cell-tooltip__buttons-wrp",children:n.map(r=>l.jsx(Q,{control:r,variant:"ghost"},r.Id))}):null]}),children:l.jsx("div",{className:k("ui-builder-table-cell-tooltip__trigger",a),children:l.jsxs("p",{className:k("ui-builder-table-cell-tooltip__value",{"ui-builder-table-cell-tooltip__trimmed":s}),children:[t,h()]})})}),ye=(t,e)=>({ControlPath:e,Value:t,Key:"Value"}),ke=({valueObj:t})=>{const[e,n]=u.useState(t.value??""),{debounce:a}=P(),s=K(),h=o=>{var v,d;const{key:b}=Y((v=t==null?void 0:t.metadata)==null?void 0:v.originalValue),p={[b]:o},g=ye(p,(d=t==null?void 0:t.metadata)==null?void 0:d.originalCellId);s==null||s(g)},r=o=>{n(o),a({fn:h,value:o})};return u.useEffect(()=>{t.value&&e!==t.value&&n(t.value)},[t.value]),l.jsx(q,{onChange:r,placeholder:e,value:e,className:"ui-builder-table-cell-input-editable"})},Re=t=>{t.stopPropagation()},Ie=({valueObj:t,cellStyleCssClass:e,isCellTextCropped:n,isFullWidth:a})=>{var s,h,r;const o=U(),v=(s=t==null?void 0:t.metadata)==null?void 0:s.linkData,d=()=>{const f=e?Number.parseInt(e.replace(/\D/g,""),10):0;return f?l.jsx("div",{className:`ui-builder-table-cell__progress-bar score-${f}`}):""};if(v){const{Text:f,Href:w}=v??{};return l.jsx("a",{className:k("ui-builder-table-cell__link",e),href:w,title:f,target:"_blank",onClick:Re,rel:"noreferrer",children:f})}const b=(h=t==null?void 0:t.metadata)==null?void 0:h.buttonData;if(b)return b.Tooltip?l.jsx(Ne,{value:t.value,text:b.Text,buttons:b.Buttons,triggerClassName:e,isCellTextCropped:n,getScoreProgress:d}):l.jsx("div",{className:"ui-builder-table-cell__handler-btn-wrap",children:(r=b==null?void 0:b.Buttons)==null?void 0:r.map(f=>l.jsx(Q,{control:f,variant:"ghost",className:"ui-builder-table-cell__handler-btn"},f.Id))});if(o)return l.jsx(ke,{valueObj:t});const p=(t==null?void 0:t.value)??"",g=e==null?void 0:e.includes("bordered");return l.jsx(G,{title:n?p:"",children:l.jsxs("p",{className:k("ui-builder-table-cell__content",e,{"ui-builder-table-cell__content--trimmed":n,"ui-builder-table-cell__bordered-tag":!a&&g}),children:[p,d()]})})},Ee=({onClick:t,cell:e,rowIndex:n,isCellSelected:a,colStyles:s,cellsStyle:h})=>{var r,o;const v=e.getValue(),d=me(e),b=U(),p=u.useMemo(()=>{const S=h==null?void 0:h.find(({Id:c})=>c===d);return S==null?void 0:S.Style.CssClass},[h,d]),g=u.useMemo(()=>{const S=s==null?void 0:s.find(({Id:c})=>c===n);return S==null?void 0:S.Style.CssClass},[s,n]),f=((o=(r=e.column.columnDef)==null?void 0:r.meta)==null?void 0:o.sizeSettings)??{},w=g==null?void 0:g.includes("text-ellipsis"),C=g==null?void 0:g.includes("fullWidth"),_={position:"relative",transition:"width transform 0.2s ease-in-out",...f,width:e.column.getSize(),maxWidth:e.column.getSize(),key:e.id,overflow:"hidden"};return l.jsx("td",{className:k("ui-builder-table-cell",a&&"ui-builder-table-cell--selected",b&&"ui-builder-table-cell--editable",g),style:_,onClick:t,children:l.jsx(Ie,{valueObj:v,cellStyleCssClass:p,isCellTextCropped:w,isFullWidth:C})})},Fe=({onTableRowClick:t,row:e,rowSelection:n,handleKeyDown:a,handleCellClick:s,cellSelection:h,tableStyles:r})=>{const o=u.useMemo(()=>{var d;const b=(d=r==null?void 0:r.RowStyles)==null?void 0:d.find(({Id:p})=>p===e.index);return b==null?void 0:b.Style.CssClass},[e.index]),v=e.getVisibleCells();return l.jsx("tr",{className:k("ui-builder-table__row",e.index===n&&"ui-builder-table__row--selected",o),onClick:t,tabIndex:0,onKeyDown:a,"data-row-index":e.index,children:v.map((d,b)=>l.jsx(Ee,{cell:d,rowIndex:b,onClick:()=>s(d),isCellSelected:h===d.id,colStyles:r==null?void 0:r.ColStyles,cellsStyle:r==null?void 0:r.CellStyles},d.id))})},Ae=({table:t,controlPath:e,cells:n,selectedRow:a,headers:s,tableStyles:h})=>{const r=u.useRef(null),[o,v]=u.useState(a),[d,b]=u.useState(void 0),p=te(),{debounce:g}=P(),f=K(),w=i=>{const m=ve(e,i);f==null||f(m)},C=i=>g({fn:w,value:i}),_=i=>{const m=Number.parseInt(i.currentTarget.dataset.rowIndex??"");o!==m&&(v(m),w(m))},S=i=>{b(i.id);const m=i.getValue();n!=null&&n.find(x=>{const{key:N,value:E}=Y(x.Value);return m===E&&N===oe.Key})&&(p==null||p({key:ae(m),type:ue(m)}))},c=i=>{var m,x,N,E;i.stopPropagation();const y=Number.parseInt(i.currentTarget.dataset.rowIndex??""),R=(m=r.current)==null?void 0:m.children[y],F=((x=r.current)==null?void 0:x.children.length)??0,A=d==null?void 0:d.split("_")[1],L=d==null?void 0:d.split("_")[0],T=s.findIndex(j=>j===A);switch(i.key){case D.ArrowUp:{const j=y-1<0?F-1:y-1;v(j);const I=y-1<0?(N=r.current)==null?void 0:N.children[F-1]:R==null?void 0:R.previousElementSibling;I==null||I.focus();const M=`${j}_${A}`;b(M),C(j);break}case D.ArrowDown:{const j=y+1>F-1?0:y+1;v(j);const I=y+1>F-1?(E=r.current)==null?void 0:E.children[0]:R==null?void 0:R.nextElementSibling;I==null||I.focus();const M=`${j}_${A}`;b(M),C(j);break}case D.ArrowLeft:{const j=T-1<0?s.length-1:T-1,I=`${L}_${s[j]}`;b(I);break}case D.ArrowRight:{const j=T+1>s.length-1?0:T+1,I=`${L}_${s[j]}`;b(I);break}case D.Tab:i.preventDefault(),i.stopPropagation(),R==null||R.focus();break}};return u.useEffect(()=>{v(typeof a=="number"?a:void 0)},[a]),u.useEffect(()=>{var i;if(o!==void 0&&r.current){const m=(i=r.current)==null?void 0:i.children[o];m&&m.scrollIntoView({behavior:"smooth",block:"nearest"})}},[o]),l.jsx("tbody",{className:"ui-builder-table__body",ref:r,children:t.getRowModel().rows.map(i=>l.jsx(Fe,{onTableRowClick:_,row:i,rowSelection:o,handleKeyDown:c,handleCellClick:S,cellSelection:d,tableStyles:h},i.id))})},ze=({control:t})=>{const{Cells:e,ColHeaders:n,RowCount:a,ColCount:s,SelectedRow:h,MultiHeaderSeparator:r,ManualColsWidth:o,ColFilters:v,CellStyles:d,Editable:b=!1}=t,p=u.useRef(null),[g,f]=u.useState(()=>n),w=u.useMemo(()=>Z({Cells:e,colsCount:s,rowsCount:a,headers:n}),[e,s,n,a]),C=u.useMemo(()=>{var c;return ee(n,r,o,(c=p.current)==null?void 0:c.offsetWidth)},[n,g,p.current]),_=le({data:w,columns:C,state:{columnOrder:g},onColumnOrderChange:f,enableRowSelection:!0,enableMultiRowSelection:!1,getCoreRowModel:ne(),getSortedRowModel:ie(),getFilteredRowModel:se(),columnResizeMode:"onChange",columnResizeDirection:"ltr"}),S=u.useCallback(()=>l.jsxs("table",{className:"ui-builder-table",style:{width:_.getCenterTotalSize()},children:[l.jsx(Se,{table:_,colFilters:v}),l.jsx(je,{isTableEditable:b,children:l.jsx(Ae,{table:_,controlPath:t.ControlPath,cells:e,selectedRow:h,headers:n,tableStyles:d})})]}),[n,g,p.current]);return l.jsx("div",{ref:p,"data-tid":t.ControlPath,className:"ui-builder-table__wrap",children:S()})};export{ze as default};
