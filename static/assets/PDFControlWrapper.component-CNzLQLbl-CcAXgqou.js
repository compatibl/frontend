/**
 * Copyright (C) 2003-present CompatibL. All rights reserved.
 * This file contains valuable trade secrets and may be copied, stored, used,
 * or distributed only in compliance with the terms of a written commercial
 * license from CompatibL and with the inclusion of this copyright notice.
 */
const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-dLgMHcD0.js","assets/controls-BzKGYbpU.js","assets/react-CxujAPCK.js","assets/monaco-C3uQlWyP.js","assets/monaco-Qi0rki7L.css","assets/uikit-Djry2pI2.js","assets/xlsx-TNCHBusx.js","assets/plotly-Cr11kGvO.js","assets/index-CLtYBbI0.css"])))=>i.map(i=>d[i]);
import{_ as He}from"./monaco-C3uQlWyP.js";import{Y as ae,j as u,q as Ke,H as We,I as $e,A as W,E as L,K as Ue,L as Ve,M as qe,k as H,O as Ye,X as Xe,P as Ge,R as Je,T as Ze,G as Z,Z as Qe,_ as et,J as ee,o as tt,a0 as nt,a1 as le,a2 as st,a3 as rt,a4 as it,a5 as ot,a6 as at}from"./controls-BzKGYbpU.js";import{r as l,b as lt}from"./react-CxujAPCK.js";import{G as ct,v as ut,u as ht,P as dt}from"./index-dLgMHcD0.js";import{r as Q}from"./v4-C71QHj5u-OHFAfwco.js";function ft(s){return r=>{s.forEach(e=>{typeof e=="function"?e(r):e!=null&&(e.current=r)})}}var mt=Object.defineProperty,gt=(s,r,e)=>r in s?mt(s,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[r]=e,$=(s,r,e)=>gt(s,typeof r!="symbol"?r+"":r,e);function D(s,r,e){let t=e.initialDeps??[],n;return()=>{var i,o,a,h;let d;e.key&&(i=e.debug)!=null&&i.call(e)&&(d=Date.now());const g=s();if(!(g.length!==t.length||g.some((p,f)=>t[f]!==p)))return n;t=g;let v;if(e.key&&(o=e.debug)!=null&&o.call(e)&&(v=Date.now()),n=r(...g),e.key&&(a=e.debug)!=null&&a.call(e)){const p=Math.round((Date.now()-d)*100)/100,f=Math.round((Date.now()-v)*100)/100,I=f/16,b=(y,O)=>{for(y=String(y);y.length<O;)y=" "+y;return y};console.info(`%câ± ${b(f,5)} /${b(p,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*I,120))}deg 100% 31%);`,e==null?void 0:e.key)}return(h=e==null?void 0:e.onChange)==null||h.call(e,n),n}}function J(s,r){if(s===void 0)throw new Error("Unexpected undefined");return s}const pt=(s,r)=>Math.abs(s-r)<1,xt=(s,r)=>{let e;return function(...t){clearTimeout(e),e=setTimeout(()=>s.apply(this,t),r)}},vt=s=>s,bt=s=>{const r=Math.max(s.startIndex-s.overscan,0),e=Math.min(s.endIndex+s.overscan,s.count-1),t=[];for(let n=r;n<=e;n++)t.push(n);return t},St=(s,r)=>{const e=s.scrollElement;if(!e)return;const t=i=>{const{width:o,height:a}=i;r({width:Math.round(o),height:Math.round(a)})};if(t(e.getBoundingClientRect()),typeof ResizeObserver>"u")return()=>{};const n=new ResizeObserver(i=>{const o=i[0];if(o!=null&&o.borderBoxSize){const a=o.borderBoxSize[0];if(a){t({width:a.inlineSize,height:a.blockSize});return}}t(e.getBoundingClientRect())});return n.observe(e,{box:"border-box"}),()=>{n.unobserve(e)}},re={passive:!0},It=typeof window>"u"?!0:"onscrollend"in window,Ct=(s,r)=>{const e=s.scrollElement;if(!e)return;let t=0;const n=It?()=>{}:xt(()=>{r(t,!1)},150),i=h=>()=>{t=e[s.options.horizontal?"scrollLeft":"scrollTop"],n(),r(t,h)},o=i(!0),a=i(!1);return a(),e.addEventListener("scroll",o,re),e.addEventListener("scrollend",a,re),()=>{e.removeEventListener("scroll",o),e.removeEventListener("scrollend",a)}},yt=(s,r,e)=>{if(r!=null&&r.borderBoxSize){const t=r.borderBoxSize[0];if(t)return Math.round(t[e.options.horizontal?"inlineSize":"blockSize"])}return Math.round(s.getBoundingClientRect()[e.options.horizontal?"width":"height"])},Et=(s,{adjustments:r=0,behavior:e},t)=>{var n,i;const o=s+r;(i=(n=t.scrollElement)==null?void 0:n.scrollTo)==null||i.call(n,{[t.options.horizontal?"left":"top"]:o,behavior:e})};class Mt{constructor(r){this.unsubs=[],this.scrollElement=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollDirection=null,this.scrollAdjustments=0,this.measureElementCache=new Map,this.observer=(()=>{let e=null;const t=()=>e||(typeof ResizeObserver<"u"?e=new ResizeObserver(n=>{n.forEach(i=>{this._measureElement(i.target,i)})}):null);return{disconnect:()=>{var n;return(n=t())==null?void 0:n.disconnect()},observe:n=>{var i;return(i=t())==null?void 0:i.observe(n,{box:"border-box"})},unobserve:n=>{var i;return(i=t())==null?void 0:i.unobserve(n)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([t,n])=>{typeof n>"u"&&delete e[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:vt,rangeExtractor:bt,onChange:()=>{},measureElement:yt,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,...e}},this.notify=(e,t)=>{var n,i;const{startIndex:o,endIndex:a}=this.range??{startIndex:void 0,endIndex:void 0},h=this.calculateRange();(e||o!==(h==null?void 0:h.startIndex)||a!==(h==null?void 0:h.endIndex))&&((i=(n=this.options).onChange)==null||i.call(n,this,t))},this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.scrollElement=null},this._didMount=()=>(this.measureElementCache.forEach(this.observer.observe),()=>{this.observer.disconnect(),this.cleanup()}),this._willUpdate=()=>{const e=this.options.getScrollElement();this.scrollElement!==e&&(this.cleanup(),this.scrollElement=e,this._scrollToOffset(this.scrollOffset,{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,t=>{this.scrollRect=t,this.notify(!1,!1)})),this.unsubs.push(this.options.observeElementOffset(this,(t,n)=>{this.scrollAdjustments=0,this.scrollDirection=n?this.scrollOffset<t?"forward":"backward":null,this.scrollOffset=t;const i=this.isScrolling;this.isScrolling=n,this.notify(i!==n,n)})))},this.getSize=()=>this.scrollRect[this.options.horizontal?"width":"height"],this.getMeasurementOptions=D(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey],(e,t,n,i)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:n,getItemKey:i}),{key:!1}),this.getFurthestMeasurement=(e,t)=>{const n=new Map,i=new Map;for(let o=t-1;o>=0;o--){const a=e[o];if(n.has(a.lane))continue;const h=i.get(a.lane);if(h==null||a.end>h.end?i.set(a.lane,a):a.end<h.end&&n.set(a.lane,!0),n.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((o,a)=>o.end===a.end?o.index-a.index:o.end-a.end)[0]:void 0},this.getMeasurements=D(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:t,scrollMargin:n,getItemKey:i},o)=>{const a=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const h=this.measurementsCache.slice(0,a);for(let d=a;d<e;d++){const g=i(d),v=this.options.lanes===1?h[d-1]:this.getFurthestMeasurement(h,d),p=v?v.end+this.options.gap:t+n,f=o.get(g),I=typeof f=="number"?f:this.options.estimateSize(d),b=p+I,y=v?v.lane:d%this.options.lanes;h[d]={index:d,start:p,size:I,end:b,key:g,lane:y}}return this.measurementsCache=h,h},{key:!1,debug:()=>this.options.debug}),this.calculateRange=D(()=>[this.getMeasurements(),this.getSize(),this.scrollOffset],(e,t,n)=>this.range=e.length>0&&t>0?wt({measurements:e,outerSize:t,scrollOffset:n}):null,{key:!1,debug:()=>this.options.debug}),this.getIndexes=D(()=>[this.options.rangeExtractor,this.calculateRange(),this.options.overscan,this.options.count],(e,t,n,i)=>t===null?[]:e({startIndex:t.startIndex,endIndex:t.endIndex,overscan:n,count:i}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const t=this.options.indexAttribute,n=e.getAttribute(t);return n?parseInt(n,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{const n=this.measurementsCache[this.indexFromElement(e)];if(!n||!e.isConnected){this.measureElementCache.forEach((a,h)=>{a===e&&(this.observer.unobserve(e),this.measureElementCache.delete(h))});return}const i=this.measureElementCache.get(n.key);i!==e&&(i&&this.observer.unobserve(i),this.observer.observe(e),this.measureElementCache.set(n.key,e));const o=this.options.measureElement(e,t,this);this.resizeItem(n,o)},this.resizeItem=(e,t)=>{const n=this.itemSizeCache.get(e.key)??e.size,i=t-n;i!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(e,i,this):e.start<this.scrollOffset+this.scrollAdjustments)&&this._scrollToOffset(this.scrollOffset,{adjustments:this.scrollAdjustments+=i,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(e.index),this.itemSizeCache=new Map(this.itemSizeCache.set(e.key,t)),this.notify(!0,!1))},this.measureElement=e=>{e&&this._measureElement(e,void 0)},this.getVirtualItems=D(()=>[this.getIndexes(),this.getMeasurements()],(e,t)=>{const n=[];for(let i=0,o=e.length;i<o;i++){const a=e[i],h=t[a];n.push(h)}return n},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const t=this.getMeasurements();return J(t[ce(0,t.length-1,n=>J(t[n]).start,e)])},this.getOffsetForAlignment=(e,t)=>{const n=this.getSize();t==="auto"&&(e<=this.scrollOffset?t="start":e>=this.scrollOffset+n?t="end":t="start"),t==="start"?e=e:t==="end"?e=e-n:t==="center"&&(e=e-n/2);const i=this.options.horizontal?"scrollWidth":"scrollHeight",o=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[i]:this.scrollElement[i]:0)-this.getSize();return Math.max(Math.min(o,e),0)},this.getOffsetForIndex=(e,t="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const n=J(this.getMeasurements()[e]);if(t==="auto")if(n.end>=this.scrollOffset+this.getSize()-this.options.scrollPaddingEnd)t="end";else if(n.start<=this.scrollOffset+this.options.scrollPaddingStart)t="start";else return[this.scrollOffset,t];const i=t==="end"?n.end+this.options.scrollPaddingEnd:n.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(i,t),t]},this.isDynamicMode=()=>this.measureElementCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&(clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(e,{align:t="start",behavior:n}={})=>{this.cancelScrollToIndex(),n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:n})},this.scrollToIndex=(e,{align:t="auto",behavior:n}={})=>{e=Math.max(0,Math.min(e,this.options.count-1)),this.cancelScrollToIndex(),n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const[i,o]=this.getOffsetForIndex(e,t);this._scrollToOffset(i,{adjustments:void 0,behavior:n}),n!=="smooth"&&this.isDynamicMode()&&(this.scrollToIndexTimeoutId=setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.measureElementCache.has(this.options.getItemKey(e))){const[a]=this.getOffsetForIndex(e,o);pt(a,this.scrollOffset)||this.scrollToIndex(e,{align:o,behavior:n})}else this.scrollToIndex(e,{align:o,behavior:n})}))},this.scrollBy=(e,{behavior:t}={})=>{this.cancelScrollToIndex(),t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.scrollOffset+e,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var e;const t=this.getMeasurements();let n;return t.length===0?n=this.options.paddingStart:n=this.options.lanes===1?((e=t[t.length-1])==null?void 0:e.end)??0:Math.max(...t.slice(-this.options.lanes).map(i=>i.end)),n-this.options.scrollMargin+this.options.paddingEnd},this._scrollToOffset=(e,{adjustments:t,behavior:n})=>{this.options.scrollToFn(e,{behavior:n,adjustments:t},this)},this.measure=()=>{var e,t;this.itemSizeCache=new Map,(t=(e=this.options).onChange)==null||t.call(e,this,!1)},this.setOptions(r),this.scrollRect=this.options.initialRect,this.scrollOffset=typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset,this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}),this.notify(!1,!1)}}const ce=(s,r,e,t)=>{for(;s<=r;){const n=(s+r)/2|0,i=e(n);if(i<t)s=n+1;else if(i>t)r=n-1;else return n}return s>0?s-1:0};function wt({measurements:s,outerSize:r,scrollOffset:e}){const t=s.length-1,n=ce(0,t,o=>s[o].start,e);let i=n;for(;i<t&&s[i].end<e+r;)i++;return{startIndex:n,endIndex:i}}const jt=typeof document<"u"?l.useLayoutEffect:l.useEffect;function Tt(s){const r=l.useReducer(()=>({}),{})[1],e={...s,onChange:(n,i)=>{var o;i?lt.flushSync(r):r(),(o=s.onChange)==null||o.call(s,n,i)}},[t]=l.useState(()=>new Mt(e));return t.setOptions(e),l.useEffect(()=>t._didMount(),[]),jt(()=>t._willUpdate()),t}function zt(s){return Tt({observeElementRect:St,observeElementOffset:Ct,scrollToFn:Et,...s})}const kt=s=>s.replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&").replace(/([^\\*])/g,"$1\\s*");function Ot(s,r){return r.slice(0,s).reduce((e,t)=>e+t.height,0)}function Rt(s){return at(s)?["str","dir","transform","width","height","fontName","hasEOL"].every(r=>r in s):!1}async function _t(s){return(await s.getTextContent()).items.filter(Rt).map(r=>{let e=r.str||"";return r.hasEOL&&(e+=" "),e}).join("")}function ue(s,r){const e=new RegExp(kt(s),"ig");return Array.from(r.matchAll(e),t=>{const n=t.index??0;return{startIndex:n,endIndex:n+t[0].length}})}const U=["marker-yellow-tan","marker-vivid-tangerine","marker-pink-rose","marker-purple-mimosa","marker-corn-yellow","marker-crystal-blue","marker-turquoise-blue","marker-pale-olive-green"],Pt=({page:s,lastPage:r,onChangePage:e})=>{const[t,n]=l.useState(null);l.useEffect(()=>{n(s)},[s]);const i=()=>{if(!t)return n(s);const o=t>r,a=t<1;if(Number.isNaN(t)||o||a)return n(s);t!==s&&e(t)};return u.jsx(it,{variant:"outlined",className:"ui-builder-pdf-control-input-pagination",value:t,onChange:o=>n(o?Number(o):null),onKeyDown:o=>{(o.code===H.Enter||o.code===H.NumpadEnter)&&i()},onBlur:i})},Nt=({currentPage:s=1,lastPage:r=1,onChangePage:e})=>{const t=l.useMemo(()=>s===1,[s]),n=l.useMemo(()=>s===r,[s,r]),i=l.useCallback(()=>{t||e(s-1)},[t,s,e]),o=l.useCallback(()=>{n||e(s+1)},[n,s,e]);return u.jsxs("div",{className:"ui-builder-pdf-control-pagination__container",children:[u.jsx(W,{title:"Previous page",children:u.jsx(L,{type:"tertiary",iconBefore:u.jsx(Qe,{}),disabled:t,onClick:i})}),u.jsx(W,{title:"Next page",children:u.jsx(L,{type:"tertiary",iconBefore:u.jsx(et,{}),disabled:n,onClick:o})}),u.jsxs("div",{className:"ui-builder-pdf-control-pagination__wrap",children:[u.jsx(Pt,{page:s,lastPage:r,onChangePage:e}),u.jsx("span",{children:"/"}),u.jsx("span",{children:r})]})]})},he=l.forwardRef((s,r)=>{var e,t;const n=l.useRef(null),{debounce:i,isLoading:o}=ae(),a=(((t=(e=n.current)==null?void 0:e.input)==null?void 0:t.value)||"").length>0,h=s.matchedTermsSize===0,d=s.matchedTermsSize===0,g=()=>{h||s.onPreviousMatch()},v=()=>{d||s.onNextMatch()},p=b=>{var y,O;const S=b.code===H.Enter||b.code===H.NumpadEnter,w=((O=(y=n.current)==null?void 0:y.input)==null?void 0:O.value)??"",x=s.matchedTermsSize>0;S&&x&&s.onChangeSearch(w)},f=()=>{var b;return(b=n.current)==null?void 0:b.focus()},I=()=>{var b;(b=n.current)!=null&&b.input&&(n.current.input.value="")};return l.useImperativeHandle(r,()=>({focus:f,clear:I})),u.jsx(Ke,{ref:n,variant:"outlined",className:"ui-builder-pdf-search-input",placeholder:"Enter to search",onChange:b=>i({fn:s.onChangeSearch,value:b}),onKeyDown:p,prefix:u.jsx(We,{}),suffix:u.jsxs("div",{className:"ui-builder-pdf-search-input__suffix",children:[o?u.jsx($e,{}):a?u.jsxs("div",{className:"ui-builder-pdf-search-input__status",children:[s.currentMatchedTerm," / ",s.matchedTermsSize]}):null,u.jsx(W,{title:"Previous match",children:u.jsx(L,{variant:"ghost",type:"secondary",disabled:h,onClick:g,iconBefore:u.jsx(Ue,{})})}),u.jsx(W,{title:"Next match",children:u.jsx(L,{variant:"ghost",type:"secondary",disabled:d,onClick:v,iconBefore:u.jsx(Ve,{})})})]})})});he.displayName="PdfSearchInput";const At=({currentMatchedTerm:s,matchedTermsSize:r,isOpen:e,onClose:t,onChangeSearch:n,onNextMatch:i,onPreviousMatch:o,isClosable:a=!0})=>{const h=l.useRef(null);return l.useEffect(()=>{h.current&&(e?h.current.focus():(h.current.clear(),n("")))},[e]),u.jsx("div",{className:ee("ui-builder-pdf-search-container",{"ui-builder-pdf-search-container--isClosable":a}),children:u.jsxs("div",{className:"ui-builder-pdf-search-container__wrap",children:[u.jsx(he,{ref:h,currentMatchedTerm:s,matchedTermsSize:r,onNextMatch:i,onPreviousMatch:o,onChangeSearch:n}),a&&u.jsx(L,{className:"ui-builder-pdf-search-container__button",onClick:t,children:u.jsx(tt,{clickable:!1,SvgIcon:nt})})]})})};class V{constructor(r=[]){$(this,"charIndexes",[]),this.charIndexes=r}static createByElements(r){const e=r.map(t=>t.textContent).reduce((t,n,i)=>ot(n)?n.length===0?t.concat([{char:" ",charIndexInSpan:0,spanIndex:i}]):t.concat(n.split("").map((o,a)=>({char:o,charIndexInSpan:a,spanIndex:i}))):t,[]);return new V(e)}get isEmpty(){return this.charIndexes.length===0}get fullText(){return this.charIndexes.map(r=>r.char).join("")}slice(r,e){const t=this.charIndexes.slice(r,e);return new V(t)}groupBySpanIndex(){return this.charIndexes.reduce((r,e)=>({...r,[e.spanIndex]:(r[e.spanIndex]||[]).concat([e])}),{})}}const ie=s=>{"remove"in s&&s.remove()},Bt=(s,r)=>{ie(s),r.parentNode&&r.before(s),ie(r)},Ft=s=>{const r=s.parentNode;if(!r)return;const e=document.createRange();e.selectNodeContents(s),Bt(e.extractContents(),s),r.normalize()},Dt=(s,r)=>{const e=s.getBoundingClientRect(),t=r.getBoundingClientRect();return e.top>=t.top&&e.bottom<=t.bottom},Lt=(s,r)=>s.top<r.top?-1:s.top>r.top?1:s.left<r.left?-1:s.left>r.left?1:0,Ht=s=>{const r=s.slice().sort(Lt),e=r.reduce((t,n,i)=>Object.hasOwn(t,n.index)?t:{...t,[n.index]:i},{});return r.map(t=>({...t,index:e[t.index],uuid:Q()}))},de="pdf-highlight",Kt=({isActive:s,index:r,left:e,top:t,height:n,width:i,background:o})=>{const a=o?{"--background-highlight-color":`var(--uc-${o})`}:{};return u.jsx("div",{"data-index":r,style:{width:i,height:n,left:e,top:t,...a},className:ee("ui-builder-pdf-control-highlight",de,{"ui-builder-pdf-control-highlight--active":s,"ui-builder-pdf-control-highlight--default":o})})},Wt=({className:s,highlights:r,activeIndex:e})=>r.length===0?null:u.jsx("div",{className:s,children:r.map(t=>u.jsx(Kt,{isActive:t.index===e,...t},t.uuid))});class $t{constructor(r,e){$(this,"charIndexes"),$(this,"elements",[]),this.charIndexes=r,this.elements=e}toRectWithCoordinates(r){var e;const{firstChild:t}=this.element;if(!t||t.nodeType!==Node.TEXT_NODE)return null;const n=((e=t.textContent)==null?void 0:e.length)??0,{start:i,end:o}=this.offsets;if(i>n||o+1>n)return null;const a=this.createRange(t,i,o+1);return this.normalizedCoordinatesByParent(r,this.getRectAndCoordinatesByRange(a))}normalizedCoordinatesByParent(r,e){return{...e,left:e.left-r.left,top:e.top-r.top}}getRectAndCoordinatesByRange(r){const e=document.createElement("span");r.surroundContents(e);const t=e.getBoundingClientRect(),n={left:t.left,top:t.top,height:t.height,width:t.width};return Ft(e),n}createRange(r,e,t){const n=document.createRange();return n.setStart(r,e),n.setEnd(r,t),n}get offsets(){const r=this.charIndexes[0].charIndexInSpan,e=this.charIndexes.length===1?r:this.charIndexes[this.charIndexes.length-1].charIndexInSpan;return{start:r,end:e}}get element(){return this.elements[this.charIndexes[0].spanIndex]}}class Ut{constructor(r){$(this,"charIndexes"),this.charIndexes=r}removeSpacesBetweenWords(){return this.charIndexes=this.charIndexes.filter(r=>r.length!==1||r[0].char.trim()!==""),this}generateRectWithCoordinates(r,e){return this.charIndexes.reduce((t,n)=>{const i=new $t(n,e).toRectWithCoordinates(r);return i&&t.push(i),t},[])}}const Vt="_page_wsfkv_1",qt="_highlights_wsfkv_5",oe={page:Vt,highlights:qt},Yt=({onScrollToOffset:s,currentMatchedTerm:r,search:e,documentRef:t,containerRef:n,pageNumber:i,containerWidth:o,selections:a})=>{const[h,{setFalse:d}]=le(!1),[g,v]=l.useState([]),[p,f]=l.useState([]),I=(r==null?void 0:r.page)!==i?-1:r.matchIndex;l.useEffect(()=>{const S=(r==null?void 0:r.page)===i,w=p.length===0;if(!S||!t.current||!n.current||w||!h)return;const x=t.current.querySelector(`div[data-page-number="${i}"] .${de}[data-index="${r.matchIndex}"]`);x&&!Dt(x,n.current)&&s(x.offsetTop),d()},[r,p,h]);const b=l.useCallback(()=>{if(!e||!t.current){f([]);return}const S=t.current.querySelector(`div[data-page-number="${i}"] .textLayer`);if(!S)return;const w=S.getBoundingClientRect(),x=Array.from((S==null?void 0:S.querySelectorAll('[role="presentation"]'))??[]),C=V.createByElements(x);if(C.isEmpty)return;const R=ue(e,C.fullText).map(T=>C.slice(T.startIndex,T.endIndex).groupBySpanIndex()).reduce((T,j,_)=>{const P=new Ut(Object.values(j)).removeSpacesBetweenWords().generateRectWithCoordinates(w,x).map(A=>({...A,index:_,uuid:Q()}));return T.concat(P)},[]);f(Ht(R))},[i,e]),y=S=>!n.current||!S?1:n.current.clientWidth/S,O=S=>{const w=[];a==null||a.forEach((x,C)=>{x.Areas.forEach(({X:R,Y:T,Width:j,Height:_,Page:P})=>{P===i&&w.push({index:C+T,left:R*S,top:T*S,width:j*S,height:_*S,background:U[C%U.length],uuid:Q()})})}),v(w)};return u.jsx(dt,{className:oe.page,pageNumber:i,loading:u.jsx(Z,{loading:!0}),onRenderTextLayerSuccess:b,width:o,onRenderSuccess:({originalWidth:S})=>{if(!a)return;const w=y(S);O(w)},children:u.jsx(Wt,{className:oe.highlights,highlights:[...g,...p],activeIndex:I})})};function Xt(){const[s,r]=l.useState([]),[e,t]=l.useState(0),[n,i]=l.useReducer(p=>p+1,0),o=s.length,a=l.useMemo(()=>{const p=s[e-1];return p?{...p}:void 0},[s,e,n]),h=p=>{r(p),t(p.length===0?0:1)},d=l.useCallback(()=>{r([]),t(0)},[]),g=l.useCallback((p=!0)=>{t(f=>{if(o===0||f===0)return f;const I=f===1;return p?I?o:f-1:I?f:f-1}),i()},[o]),v=l.useCallback((p=!0)=>{t(f=>{if(o===0||f===0)return f;const I=f===o;return p?I?1:f+1:I?f:f+1}),i()},[s.length]);return{currentMatchedTerm:a,currentMatchedIndex:e,matchedSize:o,previous:g,next:v,reset:d,update:h,forceUpdateCurrentMatchedTerm:i}}function Gt({documentRef:s,pdfRef:r}){const[e,{toggle:t,setFalse:n}]=le(!1),[i,o]=l.useState(""),{currentMatchedTerm:a,currentMatchedIndex:h,matchedSize:d,reset:g,next:v,previous:p,update:f,forceUpdateCurrentMatchedTerm:I}=Xt(),b=l.useRef([]),y=l.useCallback(x=>{b.current=x},[]),O=x=>(d>1?v():I(),x),S=x=>{let C=[];b.current.forEach((R,T)=>{const j=T+1,_=ue(x,R).map((P,A)=>({...P,page:j,matchIndex:A}));C=C.concat(_)}),f(C)},w=l.useCallback(x=>{o(C=>C===x?O(x):(r.current&&(x?S(x):g()),x))},[d]);return l.useEffect(()=>{const x=C=>{(C.ctrlKey||C.metaKey)&&C.code===H.KeyF&&(C.preventDefault(),C.stopPropagation(),t())};return s.current&&(s.current.setAttribute("tabIndex","-1"),s.current.addEventListener("keydown",x)),()=>{s.current&&(s.current.removeAttribute("tabIndex"),s.current.addEventListener("keydown",x))}},[]),{isShowSearch:e,onToggleSearch:t,onCloseSearch:n,search:i,onChangeSearch:w,onSetTextContents:y,currentMatchedTerm:a,matchedSize:d,currentMatchedIndex:h,onNextMatch:v,onPreviousMatch:p}}const Jt=({selections:s,onNavigate:r,containerHeight:e,pageCount:t})=>{if(!e||!t)return;const n=e/t,i=(o=>{const a=new Map;return o.forEach((h,d)=>{h.Areas.forEach(g=>{const v=a.has(g.Page),p={...g,backgroundColor:`var(--uc-${U[d%U.length]})`};v||a.set(g.Page,{_t:"rt.Selection",Page:g.Page,Areas:[]}),a.get(g.Page).Areas.push(p)})}),[...a.values()].sort((h,d)=>h.Page-d.Page)})(s);return u.jsx("div",{className:ee("ui-builder-pdf-control-navigation-bar",{height:e}),children:Object.entries(i).map(([o,a])=>u.jsx("div",{className:"ui-builder-pdf-control-navigation-bar__page-container",style:{top:n*a.Page-1,height:`${n}px`,minHeight:`${n}px`},children:a.Areas.map((h,d)=>u.jsx("div",{className:"ui-builder-pdf-control-navigation-bar__navigation-highlight",onClick:()=>r(h.Page),style:{maxHeight:`${h.Height}px`,backgroundColor:h.backgroundColor},"aria-hidden":!0},d))},o))})};function Zt(s,r){let e;const t=()=>{e&&(s(...e),e=void 0)};return(...n)=>{const i=!!e;e=n,!i&&setTimeout(t,r)}}function Qt(s,r,e){return l.useMemo(()=>Zt(s,r),e)}ct.workerSrc=`//unpkg.com/pdfjs-dist@${ut}/build/pdf.worker.min.mjs`;const en=l.lazy(()=>He(()=>import("./index-dLgMHcD0.js").then(s=>s.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(s=>({default:s.Document}))),tn=({content:s,path:r,selections:e,initialPageNumber:t=1,axiosClient:n,isResizing:i=!1})=>{var o,a,h;const d=l.useRef(null),g=l.useRef(null),v=l.useRef(null),p=l.useRef(null),f=l.useRef(0),I=l.useRef(null),b=Ye(),y=Xe(),O=Ge(),S=Je(),w=Ze(),[x,C]=l.useState(),[R,T]=l.useState(0),[j,_]=l.useState(!1),[P,A]=l.useState(0),[K,fe]=l.useState(!0),me=l.useRef(0),{debounce:te}=ae(),ge=()=>{_(!1)},pe=()=>{fe(!1)},{isShowSearch:xe,onCloseSearch:ve,onSetTextContents:be,currentMatchedTerm:B,currentMatchedIndex:Se,matchedSize:Ie,onNextMatch:Ce,search:ye,onChangeSearch:Ee,onPreviousMatch:Me}=Gt({documentRef:d,pdfRef:v}),{ref:we}=ht({onResize:c=>{C(c.width),!K&&_(!0),A(R*(c.height??0)),te({fn:ge,value:""}),K&&(c.height&&(me.current=c.height/M.length*t),te({fn:pe,value:""}))}}),je=ft([we,p]),q=l.useRef(new AbortController),[Te,Y]=l.useState(t||1),[M,ze]=l.useState([]),[ke,ne]=l.useState(""),Oe=l.useMemo(()=>({cMapUrl:"cmaps/",standardFontDataUrl:"standard_fonts/",withCredentials:!0}),[]),Re=async()=>{const c={Environment:y||"",User:S||"",Dataset:O||""};w&&Object.values(w).flat().forEach(m=>{const k=`Cl-User-Key-${m.name.replaceAll(" ","-")}`;c[k]=m.value});try{const m=await fetch(`${b}/handler/run`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...c},body:JSON.stringify({Type:"UiRecordUtil",Method:"LoadFile",Keys:[],Arguments:{FileName:r}}),credentials:"include"});if(!m.ok)throw new Error(`HTTP error! Status: ${m.status}`);const k=(await m.json())[0].Result.FileBytes;return ne(`data:application/pdf;base64,${k}`)}catch(m){console.error("getPDFFile, error:",m)}};l.useEffect(()=>{s&&ne(`data:application/pdf;base64,${s}`),r&&Re()},[s,r]);const X=c=>!g.current||!c?1:g.current.clientWidth/c,E=zt({scrollPaddingStart:-5,count:M.length,getScrollElement:()=>g.current,estimateSize:l.useCallback(c=>M[c].height*X(M[c].width),[M])});l.useEffect(()=>()=>{q.current.abort("Component will unmount")},[]),l.useEffect(()=>{if(M.length===0&&Y(1),M.length>0){const c=t-1;E.measure(),E.scrollToIndex(c,{align:"start"}),!j&&!i&&Y(t)}},[M,t,E,f.current]);const _e=c=>{v.current=c,q.current=new AbortController;const{signal:m}=q.current,k=Array.from({length:c.numPages},(z,N)=>N+1).map(z=>c.getPage(z));st(Promise.all(k).then(z=>{const N=z.map(F=>F.getViewport({scale:1})),G=z.map(_t);return Promise.all(G).then(F=>({viewports:N,textContents:F}))}).then(({viewports:z,textContents:N})=>{ze(z),be(N)}),m).catch(z=>{rt(z)||console.error(z)})},Pe=c=>{const m=c.target.scrollTop/c.target.scrollHeight;T(m)},Ne=Qt(c=>{var m;if(E.measure(),K){Pe(c);return}(i||j)&&(c.target.scrollTop=R*c.target.scrollHeight);const k=c.target.scrollTop,z=((m=g.current)==null?void 0:m.offsetHeight)??0,N=k+z/2,G=!i||!j?c.target.scrollTop/c.target.scrollHeight:R;!i&&!j&&T(G);const F=E.getVirtualItemForOffset(!i&&!j?N:P);if(!i&&!j){const Le=I.current??F.index;Y(Le+1),I.current&&(I.current=null)}},100,[E,i,R,j,K]),se=l.useCallback(c=>{const m=c-1;E.measure(),E.scrollToIndex(m,{align:"start"}),I.current=m},[E]),Ae=l.useCallback((c,m)=>{const k=Ot(c-1,M);E.scrollToOffset(k+m)},[M,E]);l.useEffect(()=>{if(!B)return;const c=B.page-1;E.getVirtualItems().some(m=>m.index===c)||se(B.page)},[B,E]);const Be=c=>{E.measure(),E.scrollToIndex(c-1,{align:"start"})},Fe=l.useCallback(c=>{const m=M[c.index].height*X(M[c.index].width);return E.resizeItem(c,m),c.index===0?0:c.start},[x,M]),De=l.useCallback(()=>{let c=0;return M.forEach(m=>{const k=(m==null?void 0:m.height)*X(m==null?void 0:m.width)||1;c=c+k}),f.current!==c&&(f.current=c),c},[x,M]);return u.jsx(l.Suspense,{fallback:u.jsx(Z,{loading:!0}),children:u.jsx("div",{className:"ui-builder-pdf-control",children:u.jsxs(en,{inputRef:d,className:"ui-builder-pdf-control__document",file:ke,options:Oe,loading:null,onLoadSuccess:_e,onLoadError:c=>{c.status===401&&(n==null||n.get("/auth/me"))},children:[u.jsx("div",{className:"ui-builder-pdf-control__pdf-controls-container-wrap",children:u.jsxs("div",{className:"ui-builder-pdf-control__pdf-controls-container",children:[u.jsx(Nt,{currentPage:Te,lastPage:(o=v==null?void 0:v.current)==null?void 0:o.numPages,onChangePage:se}),u.jsx(At,{currentMatchedTerm:Se,matchedTermsSize:Ie,onPreviousMatch:Me,onNextMatch:Ce,isOpen:xe,onClose:ve,onChangeSearch:Ee,isClosable:!1})]})}),u.jsx(Z,{loading:M.length===0,children:u.jsxs("div",{className:"ui-builder-pdf-control__pdf-container",children:[u.jsx("div",{className:"ui-builder-pdf-control__pdf-container-inner-wraper",ref:g,onScroll:Ne,children:u.jsx("div",{ref:je,className:"ui-builder-pdf-control__pdf-virtualizer-wrap",style:{height:De()},children:E.getVirtualItems().map(c=>u.jsx("div",{className:"ui-builder-pdf-control__pdf-virtualizer","data-index":c.index,style:{transform:`translateY(${Fe(c)}px)`},children:u.jsx(Yt,{currentMatchedTerm:B,documentRef:d,containerRef:g,pageNumber:c.index+1,search:ye,onScrollToOffset:m=>Ae(c.index+1,m),containerWidth:x,selections:e})},c.key))})}),e&&(e==null?void 0:e.length)!==0&&u.jsx(Jt,{selections:e,onNavigate:Be,containerHeight:(a=g==null?void 0:g.current)==null?void 0:a.offsetHeight,pageCount:(h=v==null?void 0:v.current)==null?void 0:h.numPages})]})})]})})})},nn=l.memo(tn),cn=({path:s,controlPath:r,selections:e,initialPageNumber:t,isResizing:n=!1})=>{const i=qe();return u.jsx("div",{"data-tid":r,className:"ui-builder-pdf-control-wrap",children:s?u.jsx(nn,{path:s,selections:e,initialPageNumber:t,axiosClient:i,isResizing:n},s):u.jsx("div",{className:"ui-builder-pdf-control-wrap__no-data-block",children:u.jsx("p",{className:"ui-builder-pdf-control-wrap__text",children:"No Data"})})})};export{cn as default};
